<style>
  body {
    font-family: 'Roboto', 'Noto', sans-serif;
    -webkit-font-smoothing: antialiased;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* whoever designed the default paper-menu needs to be shot */
  paper-menu,
  paper-listbox {
    padding: 0 !important;
  }
  paper-menu .iron-selected,
  paper-listbox .iron-selected {
    font-weight: inherit !important;
  }
  paper-menu paper-item,
  paper-listbox paper-item {
    min-height: 36px !important;
    white-space: nowrap;
  }
  paper-listbox paper-item::before,
  paper-listbox paper-item::after,
  paper-menu paper-item::before,
  paper-menu paper-item::after {
    display: none;
  }
  paper-listbox paper-item:hover,
  paper-menu paper-item:hover {
    background-color: #F0F0F0 !important;
    cursor: pointer;
  }

  paper-input-container {
    padding: 0 !important;
  }
</style>

<dom-module id="ghvz-app">
  <script>
    // Not sure why this HTMLImports.whenReady is really needed.
    // Something about polymer initialization order.
    // I think we're not supposed to need this.
    HTMLImports.whenReady(() => {
      Polymer({
        is: 'ghvz-app',

        properties: {
          isDesktop: {
            type: Boolean,
            value: () => !window.matchMedia("only screen and (max-width: 760px)").matches,
          },

          showSignInButton: Boolean,

          userId: {
            type: String,
          },

          gameId: {
            type: String,
            value: null,
          },

          playerId: {
            type: String,
            value: null,
          },

          firebaseDatabase: Object,

          database: {
            type: Object,
            value: () => ({
              gunsById: {},
              guns: [],
              game: {},
              games: [],
              gamesById: {},
              user: {},
            }),
          },
        },

        observers: [
          'onGameIdChanged_(gameId, firebaseDatabase)',
        ],

        attached: function() {
          this.firebaseDatabase = new FirebaseDatabase({
            set: (path, value) => this.set(path, value),
            push: (path, value) => this.push(path, value),
            splice: (path, index, numToRemove, ...toInsert) => this.splice(path, index, numToRemove, ...toInsert),
            get: (path) => this.get(path),
            onUserSignedIn: (userId) => {
              this.userId = userId;
              this.showSignInButton = false;
            },
            onAutoSignInFailed: () => {
              this.showSignInButton = true;
            },
          });
        },

        onGameIdChanged_: function(gameId) {
          this.firebaseDatabase.setGameId(gameId);
        },

        firebaseSignIn_: function() {
          this.firebaseDatabase.signIn();
        },
      });
    });
  </script>
  <template>
    <template is="dom-if" if="[[showSignInButton]]">
      <paper-button on-tap="firebaseSignIn_">Sign In</paper-button>
    </template>
    <template is="dom-if" if="[[userId]]">
      <template is="dom-if" if="[[isDesktop]]">
        <ghvz-desktop-app
            server-bridge="[[serverBridge]]"
            user-id="[[userId]]"
            game-id="{{gameId}}"
            player-id="{{playerId}}"
            database="[[database]]">
        </ghvz-desktop-app>
      </template>
      <template is="dom-if" if="[[!isDesktop]]">
        <ghvz-mobile-app
            server-bridge="[[serverBridge]]"
            user-id="[[userId]]"
            game-id="{{gameId}}"
            player-id="{{playerId}}"
            database="[[database]]">
        </ghvz-mobile-app>
      </template>
    </template>
  </template>
</dom-module>

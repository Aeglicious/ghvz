
<dom-module id="leaderboard-summary">
  <script>
    // Not sure why this HTMLImports.whenReady is really needed.
    // Something about polymer initialization order.
    // I think we're not supposed to need this.
    HTMLImports.whenReady(() => {
     Polymer({
      is: 'leaderboard-summary',

      properties: {
        serverBridge: Object,
        gameId: String,
        players: {
          type: Array,
          value: function() { return []; },
        },

        leaderboardDelegate: {
          type: Object,
          value: function() {
            return {
              getSchema: (() => ["name", "points"]),
              getHeader: ((key) => ({name: 'Name', points: 'Points'}[key])),
              getActions: (() => ["view", "grr"]),
              getActionName: ((action) => ({view: "View", grr: "Grr"}[action])),
              create: this.createLeaderboardContents_.bind(this),
              update: this.updateLeaderboardContents_.bind(this),
              doAction: this.doTableAction_.bind(this),
            };
          },
        },
      },

      observers: [
      "ready_(serverBridge, gameId)",
      ],

      ready_: function(serverBridge, gameId) {
        console.log("ready");
        serverBridge.findAllPlayersForGameId(gameId)
        .then((players) => {
          this.players = players;
        });
      },

      doTableAction_: function(player, action) {
        console.log('do action', action, ' on player', player);
        if (action == "delete") {
          var index = this.players.indexOf(player);
          this.splice('players', index, 1);
        }
      },

      createLeaderboardContents_: function(player, key) {
          // if we dont return anything, auto-table will just by default create the text node
        },

        updateLeaderboardContents_: function(element, player, propertyName, propertyPath, value) {
          //return document.createTextNode(player[key]);
        },

        onViewPlayer_: function(player) {
          console.log("view");
        },
      });
   });
 </script>
 <template>
  <style>
    auto-table {
      display: block;
    }
  </style>
  <auto-table
  id="leaderboardTable"
  delegate="[[leaderboardDelegate]]"
  items="[[players]]">
</auto-table>
</template>
</dom-module>


<dom-module id="ghvz-mobile-app">
<script>
  // Not sure why this HTMLImports.whenReady is really needed.
  // Something about polymer initialization order.
  // I think we're not supposed to need this.
  HTMLImports.whenReady(() => {
    Polymer({
      is: 'ghvz-mobile-app',

      properties: {
        bridge: Object,
        database: Object,
        user: Object,
        game: Object,
        player: Object,
        page: {
          type: String,
          observer: 'onPageChanged_',
        },

        secondPage: {
          type: String,
          value: null,
        },
      },

      onPageChanged_: function(newPage, oldPage) {
        if (newPage == 'main') {
          this.$.pages.entryAnimation = '';
          this.$.pages.exitAnimation = '';
          this.$.pages.selected = 0;
        } else {
          this.secondPage = newPage;
          this.$.pages.entryAnimation = 'slide-from-right-animation';
          this.$.pages.exitAnimation = '';
          this.$.pages.selected = 1;
        }
      },

      statsPageVisible_(secondPage) { return secondPage == 'stats'; },
      chatPageVisible_(secondPage) { return secondPage == 'chat' || secondPage.startsWith('chat/');  },
    });
  });
</script>
<style>
  :host {
    width: 100%;
    height: 100%;
    display: block;
  }
  neon-animated-pages {
    width: 100%;
    height: 100%;
  }
  neon-animatable {
    width: 100%;
    height: 100%;
    background-color: white;
  }
</style>
<template>
  <neon-animated-pages id="pages" class="flex" selected="0">
    <neon-animatable>
      <ghvz-mobile-main-page
          bridge="[[bridge]]"
          database="[[database]]"
          user="[[user]]"
          game="[[game]]"
          player="[[player]]">
      </ghvz-mobile-main-page>
    </neon-animatable>
    <neon-animatable>
      <template is="dom-if" if="[[secondPage]]">
        <template is="dom-if" if="[[statsPageVisible_(secondPage)]]">
          <ghvz-card expand with-menu>
            <div class="header">Game Stats</div>
            <ghvz-stats-page
                bridge="[[bridge]]"
                database="[[database]]"
                user="[[user]]"
                game="[[game]]"
                player="[[player]]">
            </ghvz-stats-page>
          </ghvz-card>
        </template>
        <template is="dom-if" if="[[chatPageVisible_(secondPage)]]">
          <ghvz-card expand with-menu>
            <ghvz-chat-page
                bridge="[[bridge]]"
                database="[[database]]"
                user="[[user]]"
                game="[[game]]"
                player="[[player]]"
                page="[[secondPage]]">
            </ghvz-chat-page>
          </ghvz-card>
        </template>
      </template>
    </neon-animatable>
  </neon-animated-pages>
</template>
</dom-module>

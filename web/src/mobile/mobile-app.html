
<dom-module id="ghvz-mobile-app">
<script>
  // Not sure why this HTMLImports.whenReady is really needed.
  // Something about polymer initialization order.
  // I think we're not supposed to need this.
  HTMLImports.whenReady(() => {
    Polymer({
      is: 'ghvz-mobile-app',

      properties: {
        bridge: Object,
        database: Object,

        userId: {
          type: String,
        },

        gameId: {
          type: String,
          notify: true,
        },

        playerId: {
          type: String,
          notify: true,
        },

        page: {
          type: String,
          value: '',
        },

        canInfect: {
          type: Boolean,
          computed: 'computeCanInfect_(playerId, database.game, database.game.playersById.*)',
        },

        canRegister: {
          type: Boolean,
          computed: 'computeCanRegister_(gameId, playerId)',
        },

        isPlayer: {
          type: Boolean,
          computed: 'computeIsPlayer_(playerId)',
        },
      },

      computeCanInfect_: function(playerId, game) {
        return game.playersById[playerId] && !game.playersById[playerId].infectable;
      },

      computeCanRegister_(gameId, playerId) {
        return gameId && !playerId;
      },

      computeIsPlayer_(playerId) {
        return !!playerId;
      },

      openDrawer_() {
        this.$.drawer.openDrawer();
      },
    });
  });
</script>
<style>
  .header {
    height: 48px;
    background-color: #9C27B0;
    color: white;
    font-weight: bold;
    font-size: 13pt;
    display: flex;
    align-items: center;
    padding-left: 16px;
  }
  .contents {
    margin: 16px 16px 0 16px;
    background-color: white;
  }
</style>
<template>
  <paper-drawer-panel id="drawer">
    <div drawer>
      <ghvz-game-selector
          user-id="[[userId]]"
          user="[[database.user]]"
          games="[[database.games]]"
          game-id="{{gameId}}"
          player-id="{{playerId}}">
      </ghvz-game-selector>
      dar
    </div>
    <div main>
    
      <paper-icon-button
          icon="icons:menu"
          on-tap="openDrawer_">
      </paper-icon-button>

      <template is="dom-if" if="[[canRegister]]">
        <div class="header">Join A Game</div>
        <div class="contents">
          <ghvz-game-registration
                class="content"
                bridge="[[bridge]]"
                game-id="[[gameId]]"
                user-id="[[userId]]">
          </ghvz-game-registration>
        </div>
      </template>

      <!--<template is="dom-if" if="[[isPlayer]]">

        <template is="dom-if" if="[[canInfect]]">
          <div class="header">Infect</div>
          <div class="contents">
            <ghvz-infect
                bridge="[[bridge]]"
                game-id="[[gameId]]"
                player-id="[[playerId]]">
            </ghvz-infect>
          </div>
        </template>

      </template>-->

    </div>
  </paper-drawer-panel>

</template>
</dom-module>

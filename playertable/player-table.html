
<dom-module id="player-table">
  <script>
    // Not sure why this HTMLImports.whenReady is really needed.
    // Something about polymer initialization order.
    // I think we're not supposed to need this.
    HTMLImports.whenReady(() => {
      Polymer({
        is: 'player-table',

        properties: {
          serverBridge: Object,

          gameId: String,

          players: {
            type: Array,
            value: function() { return []; },
          },

          playersTableDelegate: {
            type: Object,
            value: function() {
              return {
                getSchema: (() => ["id", "name"]),
                getHeader: ((key) => ({id: 'ID', name: 'Name'}[key])),
                getActions: (() => ["delete", "infect", "revive", "ban"]),
                getActionName: ((action) => ({delete: "Delete", infect: "Infect", revive: "Revive", ban: "Ban"}[action])),
                create: this.createPlayerTableContents_.bind(this),
                update: this.updatePlayerTableContents_.bind(this),
                doAction: this.doTableAction_.bind(this),
              };
            },
          },
        },

        observers: [
          "ready_(serverBridge, gameId)",
        ],

        ready_: function(serverBridge, gameId) {
          serverBridge.findAllPlayersForGameId(gameId)
              .then((players) => {
                this.players = players;
              });
        },

        doTableAction_: function(player, action) {
          console.log('do action', action, ' on player', player);
          if (action == "delete") {
            var index = this.players.indexOf(player);
            this.splice('players', index, 1);
          }
        },

        createPlayerTableContents_: function(player, key) {
          // if we dont return anything, auto-table will just by default create the text node
        },

        updatePlayerTableContents_: function(element, player, propertyName, propertyPath, value) {
          //return document.createTextNode(player[key]);
        },

        onDeletePlayer_: function(player) {
          var index = this.players.indexOf(player);
          if (index < 0) {
            console.error('Cant delete player, player not in list:', player);
            return;
          }
          this.splice('players', 1);
        },
      });
    });
  </script>
  <template>
    <style>
      auto-table {
        display: block;
      }
    </style>
    <auto-table
        id="playersTable"
        delegate="[[playersTableDelegate]]"
        items="[[players]]">
    </auto-table>
  </template>
</dom-module>
